define("Skwitch/Timeline/Timeline",["Seed/Seed","./interactions/all"],function(e,t){return e.extend({"+options":{config:null,initState:null,magnets:null},"+init":function(){window.timeline=this,this.initState=this.initState||this.config.get("initState"),this.interactionName=this.config.get("interactionName"),this.buildInteraction(),this.appState=this.interaction.getState(),this.targetState=this.interaction.getState(),this.interaction.forceToState(this.targetState),this.attachEvents(),this.paused=!0},onSceneChange:function(e){},findScene:function(e){var t=this.magnets.length,n;for(var r=0;r<t;r++){var i=this.magnets[r];n=i.scene||n;if(i.instant>e)return n}},play:function(){this.paused&&(this.fire("tick",this.appState),this.paused=!1,this.watch())},pause:function(){this.paused=!0},attachEvents:function(){this.events=[this.interaction.on("change",this.onInteractionChange.bind(this),this),this.interaction.on("next",this.onInteractionNext.bind(this),this)]},detachSubscriptions:function(){this.events&&this.events.send("un")},onInteractionChange:function(e){!this._first&&Math.abs(this.appState-e)>100?(this.setTargetState(e),this.appState=e,this.fire("tick",this.appState),this._first=!0):(this.config.reset("fDelta"),this.setTweener(),this.setTargetState(e))},onInteractionEnd:function(){this.detachSubscriptions(),this.setTweener("easeIn",{fDeltaStart:this.config.get("fDelta",{current:!0})/2}),this.appToMagnet(),this.interaction.forceToState(this.targetState),this.after(300,this.attachEvents.bind(this))},onInteractionNext:function(){this.config.reset("minFDelta"),this.config.reset("maxFDelta"),this.doInteractionNext()},doInteractionNext:function(){this.detachSubscriptions(),this.toNextMagnet(),this.interaction.forceToState(this.targetState),this.after(1e3,this.attachEvents.bind(this))},toNextMagnet:function(){var e=this.magnets.find(function(e){return e.instant>this.appState+2}.bind(this));e&&(this.setTweener("easeIn",{goTo:e.instant}),this.goToMagnet(e))},after:function(e,t){setTimeout(t,e)},setTweener:function(e,t){this.twinner&&this.twinner.un();var n=this.config.set.bind(this.config);if(e==="easeIn"){var r=this.appState,i=t.goTo||this.targetState,s=this.config.get("maxFDelta"),o=t.fDeltaStart||this.config.get("minFDelta");n("fDelta",o),this.twinner=this.on("tick",function(e){var t=o+Math.sin((e-r)/(i-r)*Math.PI/2)*(s-o);n("fDelta",t)}.bind(this),this)}else this.config.reset("fDelta")},buildInteraction:function(){var e=this.interactionName;this.interaction=this.sub(t[e.capitalize()+"Interaction"],{name:e,config:this.config,initAppState:this.initState,timeline:this}),this._a.body.addClass(e)},watch:function(e){setTimeout(function(){this.paused||this.appTowardTarget(),this.watch()}.bind(this),1e3/this.config.get("fps"))},setTargetState:function(e){this.targetState=e},appTowardTarget:function(){var e=this.config.get("maxFinalStatesDelta"),t=this.getStatesDelta();if(t>e){var n=this.appState;this.appState=this.appStateBetween(this.appState,this.targetState),this.fire("tick",this.appState)}},appToMagnet:function(){var e=this.findMagnet();e&&this.goToMagnet(e)},findMagnet:function(){var e=this.targetState-this.appState>=0?"future":"past",t;if(e==="future")for(var n=0;n<this.magnets.length;n++)if(this.magnets[n].instant>this.appState+.2){t=this.magnets[n];break}if(e==="past")for(var r=this.magnets.length;r--;)if(this.magnets[r].instant<this.appState-.2){t=this.magnets[r];break}return t},goToMagnet:function(e){this.setTargetState(e.instant)},getAppState:function(){return this.appState},getStatesDelta:function(){return Math.abs(this.appState-this.targetState)},appStateBetween:function(e,t){var n=e-t,r;return t+n/this.config.get("fDelta")}})});